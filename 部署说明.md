# 实时投票系统 - 前端部署说明

## 项目概述

本项目是一个实时投票系统的前端部分，使用React构建，具有以下技术栈和特性：

- React（单页面应用）
- TypeScript
- Vite（构建工具）
- Ant Design（UI组件库）
- ECharts（图表可视化）
- Framer Motion（动画效果）
- Server-Sent Events（实时数据推送）

## 环境要求

- Node.js 16.x 或更高版本
- npm 8.x 或更高版本
- 现代浏览器（支持ES6+和SSE）

## 开发环境设置

### 1. 克隆项目

```bash
git clone <项目仓库地址>
cd vote-frontend
```

### 2. 安装依赖

```bash
npm install
```

## 运行项目

### 开发环境运行

```bash
npm run dev
```

服务将在 http://localhost:5173 启动（如果端口被占用，将自动尝试其他端口，如5174, 5175, 5176等）。

### 生产环境构建

```bash
npm run build
```

构建后的文件将生成在 `dist` 目录中。

### 预览生产构建

```bash
npm run preview
```

## 测试

### 运行单元测试

```bash
npm run test
```

### 运行端到端测试

```bash
npm run test:e2e
```

## Docker部署

### 1. 创建Dockerfile

在项目根目录创建 `Dockerfile` 文件：

```dockerfile
# 构建阶段
FROM node:16-alpine as build

WORKDIR /app

# 复制package.json和package-lock.json
COPY package*.json ./

# 安装依赖
RUN npm ci

# 复制源代码
COPY . .

# 构建应用
RUN npm run build

# 生产阶段
FROM nginx:alpine

# 复制构建产物到Nginx
COPY --from=build /app/dist /usr/share/nginx/html

# 复制Nginx配置
COPY nginx.conf /etc/nginx/conf.d/default.conf

# 暴露80端口
EXPOSE 80

# 启动Nginx
CMD ["nginx", "-g", "daemon off;"]
```

### 2. 创建Nginx配置

创建 `nginx.conf` 文件：

```nginx
server {
    listen 80;
    server_name _;
    root /usr/share/nginx/html;
    index index.html;

    # 解决单页应用路由问题
    location / {
        try_files $uri $uri/ /index.html;
    }

    # 静态资源缓存策略
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
        expires 1y;
        add_header Cache-Control "public, max-age=31536000, immutable";
    }

    # 健康检查
    location /health {
        access_log off;
        return 200 'ok';
        add_header Content-Type text/plain;
    }
}
```

### 3. 构建Docker镜像

```bash
docker build -t vote-frontend:latest .
```

### 4. 运行Docker容器

```bash
docker run -d -p 80:80 --name vote-frontend vote-frontend:latest
```

现在可以通过 http://localhost 访问应用。

### 5. 使用Docker Compose（可选）

创建 `docker-compose.yml` 文件：

```yaml
version: '3.8'

services:
  frontend:
    build: .
    ports:
      - "80:80"
    restart: always

  # 如果有后端服务，可以在这里添加
  # backend:
  #   image: vote-backend:latest
  #   ports:
  #     - "8888:8888"
  #   environment:
  #     - DB_HOST=db
  #     - DB_USER=user
  #     - DB_PASSWORD=password
  #   depends_on:
  #     - db
  
  # db:
  #   image: mysql:8
  #   volumes:
  #     - db-data:/var/lib/mysql
  #   environment:
  #     - MYSQL_ROOT_PASSWORD=rootpassword
  #     - MYSQL_DATABASE=vote
  #     - MYSQL_USER=user
  #     - MYSQL_PASSWORD=password

# volumes:
#   db-data:
```

使用Docker Compose启动服务：

```bash
docker-compose up -d
```

## 环境变量配置

项目使用以下环境变量，可以在 `.env` 文件中配置：

```
# API 基础URL
VITE_API_BASE_URL=http://localhost:8888/api/v1

# 其他环境变量
VITE_APP_TITLE=实时投票系统
```

在生产环境中，可以创建 `.env.production` 文件：

```
VITE_API_BASE_URL=https://api.yourdomain.com/api/v1
VITE_APP_TITLE=实时投票系统
```

## 后端API集成

1. 确保后端服务已启动并运行在 http://localhost:8888 （或环境变量中配置的地址）

2. 后端需要提供以下API端点：
   - GET `/api/v1/votes` - 获取投票列表
   - GET `/api/v1/votes/:id` - 获取投票详情
   - POST `/api/v1/votes` - 创建投票
   - PUT `/api/v1/votes/:id` - 更新投票
   - DELETE `/api/v1/votes/:id` - 删除投票
   - POST `/api/v1/votes/:id/submit` - 提交投票
   - GET `/api/v1/votes/:id/stats` - 获取投票统计
   - GET `/api/v1/votes/:id/sse` - SSE实时数据推送

## 常见问题解决

### 1. 端口被占用

如果默认端口（5173）被占用，Vite会自动尝试其他端口（5174, 5175等）。

### 2. API连接问题

如果无法连接到后端API，请检查：
- 后端服务是否已启动
- API_BASE_URL是否配置正确
- 网络连接是否正常
- CORS设置是否正确

### 3. SSE连接问题

如果实时数据推送不工作：
- 检查浏览器是否支持SSE
- 检查SSE URL是否正确
- 检查后端SSE实现是否正确
- 检查浏览器控制台是否有错误信息

## 性能优化注意事项

1. 图片和静态资源应该使用CDN
2. 考虑启用Gzip压缩
3. 使用合适的缓存策略
4. 考虑使用服务端渲染（SSR）提高首屏加载速度

## 安全注意事项

1. 使用HTTPS
2. 实施适当的CORS策略
3. 不要在前端代码中硬编码敏感信息
4. 对用户输入进行验证和清理 